"use strict";function toDarkTheme(){document.body.classList.add("--dark-mode"),localStorage.setItem("theme","dark")}function toLightTheme(){document.body.classList.remove("--dark-mode"),localStorage.setItem("theme","light")}function switchTheme(){document.body.classList.contains("--dark-mode")?toLightTheme():toDarkTheme()}function setList(e,t=null){const s=document.getElementById(e);if(null!==t)if(s.innerHTML="","logs__list"===e){for(const e of t)if(""!==e){let t=document.createElement("li");t.textContent="["+e,s.appendChild(t)}}else for(let e of t){let t=document.createElement("li"),n=document.createElement("a");n.setAttribute("href",e),n.setAttribute("target","_blank"),n.textContent=e.substring(0,48)+"...",t.appendChild(n),s.appendChild(t)}else s.innerHTML="..."}function setUserList(e){const t=document.getElementById("users__list");if(e.length>0){t.innerHTML="";for(let s of e){let e=document.createElement("li");e.textContent=s.name;let n=document.createElement("button");"viewer"===s.role?(n.innerHTML='<svg viewBox="0 0 24 24"><path d="M18.311 2.828l2.862 2.861-15.033 15.032-3.583.722.723-3.584 15.031-15.031zm0-2.828l-16.873 16.872-1.438 7.127 7.127-1.437 16.874-16.873-5.69-5.689z"/></svg>Changer en Ã©diteur',n.onclick=()=>moveUser(s.name,"viewer","publisher")):"publisher"===s.role&&(n.innerHTML='<svg viewBox="0 0 24 24"><path d="M15 12c0 1.654-1.346 3-3 3s-3-1.346-3-3 1.346-3 3-3 3 1.346 3 3zm9-.449s-4.252 7.449-11.985 7.449c-7.18 0-12.015-7.449-12.015-7.449s4.446-6.551 12.015-6.551c7.694 0 11.985 6.551 11.985 6.551zm-7 .449c0-2.761-2.238-5-5-5-2.761 0-5 2.239-5 5 0 2.762 2.239 5 5 5 2.762 0 5-2.238 5-5z"/></svg>Changer en visualiseur',n.onclick=()=>moveUser(s.name,"publisher","viewer")),e.appendChild(n);let o=document.createElement("button");o.innerHTML='<svg viewBox="-3 -3 30 30"><path d="M23.954 21.03l-9.184-9.095 9.092-9.174-2.832-2.807-9.09 9.179-9.176-9.088-2.81 2.81 9.186 9.105-9.095 9.184 2.81 2.81 9.112-9.192 9.18 9.1z"/></svg>Supprimer',o.onclick=()=>removeUser(s.name,s.role),e.appendChild(o),t.appendChild(e)}}else t.innerHTML="..."}function ajaxPost(e){return new Promise(((t,s)=>{let n=new FormData;if(void 0!==e.args)for(const t of e.args)n.append(t.name,t.value);fetch("../../app/server/"+e.script,{method:"POST",body:n}).then((e=>{e.ok?e.text().then((e=>{try{const s=JSON.parse(e);t(s)}catch(t){s(e)}})):s(new Error(e.status+": "+e.statusText))}))}))}function browseUsers(){ajaxPost({script:"browse-users.php"}).then((e=>{e.success&&setUserList(e.content)}))}function moveUser(e,t,s){ajaxPost({script:"move-user.php",args:[{name:"user-name",value:e},{name:"from-role",value:t},{name:"to-role",value:s}]}).then((e=>{e.success&&browseUsers()}))}function removeUser(e,t){confirm("Supprimer le compte : "+e)&&ajaxPost({script:"remove-user.php",args:[{name:"user-name",value:e},{name:"user-role",value:t}]}).then((e=>{e.success&&browseUsers()}))}function managePublicAccess(e){ajaxPost({script:"manage-public-access.php",args:[{name:"action",value:e}]}).then((e=>{e.success&&setList("public-access__list",e.content)}))}function manageInvitations(e,t){ajaxPost({script:"manage-invitations.php",args:[{name:"role",value:t},{name:"action",value:e}]}).then((e=>{e.success&&setList(t+"__list",e.content)}))}function manageLogs(e){ajaxPost({script:"manage-logs.php",args:[{name:"action",value:e}]}).then((e=>{e.success&&setList("logs__list",e.content)}))}"dark"===localStorage.getItem("theme")&&toDarkTheme();